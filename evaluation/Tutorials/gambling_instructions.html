<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>Gambling</title>
    <meta charset="utf-8"  />
    <link rel="stylesheet" href="../stylesheet.css"/>
    <link href="../prism.css" rel="stylesheet" />
</head>
<body class="language-obsidian">
<script src="../prism.js"></script>
<h2>Gambling</h2>

<h3>Instructions</h3>
<p>
    At a high level, you will need to implement a Casino such that <code>Bettor</code>s will make bets (they put down some 
    <code>Money</code> and make a <code>Bet</code>
    for the predicted outcomeof a <code>Game</code>), and afterward, <code>Money</code> is given to the <code>Bettor</code>s who bet correctly.

    <br/><br/>
    Note that the logic of the game itself doesn't matter, a generic <code>Game</code> is given in the helper code below.
    However, keep in mind that a <code>Game</code> has certain states in which certain actions can take place,
    and <code>calculateOutcome()</code> returns the outcome of the game.
    <br/><br/>

    This is a very small <code>Casino</code>; only <b>one</b> <code>Game</code> can be played at at time, and <code>Bets</code> will 
    be taken for that <code>game</code>. Once the <code>Game</code> is over,
    bets can be taken for the next <code>Game</code>, and the new <code>Game</code> is played. An example sequence of events over the course of one <code>Game</code>
    is given to you in the Figure I below (more explanation about making a <code>Bet</code> is given in the <b>Requirements</b>).
    <br/><br/>
    <img src="CasinoSequence.png" alt="Casino" > </img>


    <br/><br/>
    The <code>Casino</code> contains the current <code>Game</code> being played, as well as a list of <code>Bet</code>s on that game.
    A <code>Bet</code> consists of the <code>Bettor</code> making the bet prediction, and the <code>BetPrediction</code> itself.
    The relationships between the objects are shown in Figure II below. Declarations for each of these objects are given in the 
    "Helper Code Declarations" section (Full implementations can be viewed in <code>betting_utils.obs</code>).
    <br/><br/>

    <img src="structuralDiagram.png" alt="Casino" > </img>

    <br/><br/><br/><br/>
    Implement the <code>Casino</code> contract however you would like following this overview.

    The following requirements <b>must</b> be met.
    <br/><br/>
    <b>Requirements:</b>
    <ul>
        <li> If a <code>Bettor</code> predicts the outcome correctly, the <code>Bettor</code> gets <b>twice</b> the <code>Money</code> they put down. 
            For example, if <code>Bettor</code> b puts down $5 on the correct outcome, they should receive $10 after the <code>Game</code> is played. </li>
        <li> If the <code>Bettor</code> predicted incorrectly, they lose the money they originally bet; they get nothing back.</li>
        <li> Bets should not be able to be made during or after a <code>Game</code>.</li>
        <li> Similarly, <code>Money</code> should not be distributed back to <code>Bettor</code>s until after a <code>Game</code> is played.</li>
        <li> <code>Bettor</code>s must bet on one particular <code>Game</code> at a time.</li>
        <li> Individual <code>Bettor</code>s should collect winnings from the <code>Casino</code> after a <code>Game</code>. If a <code>Bettor</code> who 
            accurately predicted the outcome of a <code>Game</code> does not collect their <code>Money</code> before the next <code>Game</code>, 
            this <code>Money</code> is kept by the <code>Casino</code>. </li>
        <li> A <code>Bettor</code> can only bet once per game; if the <code>Bettor</code> bets more than once, their original bet 
            should be replaced by the new one. </li>
        <li>A <code>Bettor</code> MUST put down <code>Money</code> at the same time that they're making a <code>Bet</code>: 
            this <code>Money</code> should go to the Casino.</li>
        <li>The <code>Casino</code> should have the ability to start a new <code>Game</code> once the current one is finished.</li>
    </ul>

    <br/>
    <b>Assumptions:</b>
    <ul>
        <li> <code>Bettor</code>s do not need to be registered; you can assume any <code>Bettor</code> can make a <code>Bet</code></li>
        <li> You can assume the <code>Casino</code> will always have enough money to pay <code>Bettor</code>s.</li>
    </ul>

    <br/>
    Start by writing an outline of the contract, including any additional fields, states, and transaction declarations. Then fill in the transactions
    to implement the program. Helper code declarations for the objects described above are given below. 
    
</p>



<br/>
<h3>Helper Code Declarations</h3>
<p>The full implementations can be viewed in <code>betting_utils.obs</code></p>

<pre>
    <code>
        //Represents the money being traded in this program
        asset contract Money {
            int amount; //Amount that this Money object holds

            //Constructor
            Money@Owned(int amt);

            //Add additional Money
            transaction mergeMoney(Money@Owned this, Money@Owned >> Unowned m);

            //Returns the amount of this Money
            transaction getAmount(Money@Owned this) returns int;

            //Use some amount of this Money
            transaction splitMoney(Money@Owned this, int amt) returns Money@Owned;
        }
    </code>

    <code>
        //Represents the bet prediction of a Bettor
        contract BetPrediction {
            string predictedOutcome; //the Bettor's prediction of the winning outcome
            int betAmount; //the amount of money the Bettor put down on this BetPrediction
        
            //Constructor
            BetPrediction@Owned(string predOut, int amount);
        
            //Returns the predicted outcome
            transaction getPredOutcome(BetPrediction@Unowned this) returns string;
        
            //Returns the betAmount
            transaction getBetAmount(BetPrediction@Unowned this) returns int;
        }
        </code>

        <code>
        //Represents a person betting on a game
        asset contract Bettor {
            Money@Owned money; //Total Money the Bettor owns
        
            //Constructor
            Bettor@Owned();
            
            //Take some Money out of the Bettor's total money
            transaction withdrawMoney(Bettor@Owned this, int amount) returns Money@Owned;
        
            //Adds Money to the Bettor's total money
            transaction receiveMoney(Bettor@Unowned this, Money@Owned >> Unowned m);
        }
    </code>

    <code>
        //Represents a single bet
        contract Bet {
            Bettor@Unowned bettor; //The Bettor making the bet
            BetPrediction@Unowned prediction; //The BetPrediction for the winner
        
            //Constructor
            Bet@Owned(Bettor@Unowned b, BetPrediction@Unowned p);
        
            //Returns a reference to the Bettor making the bet
            transaction getBettor(Bet@Unowned this) returns Bettor@Unowned;
        
            //Returns a reference to the BetPrediction the Bettor made
            transaction getBetPrediction(Bet@Unowned this) returns BetPrediction@Unowned;
        }
    </code>

    <code>
        //Represents a container of Bets
        contract BetList {

            //Constructor
            BetList@Empty();

            //Add a new Bet to the end of the list
            transaction append(Bet@Unowned newB);

            //remove a Bet with a given Bettor reference, and return that Bet
            transaction popSpecific(Bettor@Unowned bettor) returns Bet@Unowned;

            //returns true if a Bet has been placed by a Bettor
            transaction contains(Bettor@Unowned bettor) returns bool;
        }
    </code>

    <code>
        //Represents a generic game
        contract Game {

            state BeforePlay;
            state Playing;
            state FinishedPlaying;

            //Constructor
            Game@BeforePlay();

            //Start the game
            transaction startPlaying(Game@BeforePlay >> Playing this);

            //Finish the game
            transaction finishPlaying(Game@Playing >> FinishedPlaying this);

            //Returns the outcome of the game
            transaction calculateOutcome(Game@FinishedPlaying this) returns string;
        }
    </code>
</pre>


</body>
</html>